---
title: 'Astro ã‚’ github-pages ã«ãƒ‡ãƒ—ãƒ­ã‚¤ with Bun'
description: 'Bun + Astro + Github Action ã§ Github Pages ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸæ‰‹é †ã«ã¤ã„ã¦æ›¸ãã¾ã™ã€‚'
pubDate: '2023-09-18'
heroImage: '/blog-placeholder-1.jpg'
---

import Image from '../../components/Image.astro';

ã“ã®ã‚µã‚¤ãƒˆã®ä½œã‚Šæ–¹ã«ã¤ã„ã¦ã®è¨˜äº‹ã§ã™ã€‚
ã€é‰„ã¯ç†±ã„ã†ã¡ã«æ‰“ã¦ã€ã¨ã„ã†ã“ã¨ã§å¿˜ã‚Œãªã„ã†ã¡ã«è¨˜äº‹ã«ã—ã¦ãŠããŸã„ã¨æ€ã„ã¾ã™ã€‚

æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚

- Bun(1.0.2)
  - ä¸–ç•Œçš„ã§ã™ã‚‚ã‚“ã­ï¼ ä¹—ã‚‹ã—ã‹ãªã„ã€ã“ã®ãƒ“ãƒƒã‚°ã‚¦ã‚§ãƒ¼ãƒ–ã«ï¼
- Astro(3.1.0)
  - Docusaurusã‚ˆã‚Šå‹¢ã„ã‚’æ„Ÿã˜ã¾ã™
- GitHub Pages
  - ç„¡æ–™
- TypeScript(5.2.2)
  - ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã‚³ãƒ¼ãƒ‰ãŒå¥½ã
- VSCodes
  - ã„ã¤ã‚‚ã®

ã“ã®è¨˜äº‹ã®ãŸã‚ã«ç”¨æ„ã—ãŸã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã¯[ã“ã¡ã‚‰](https://github.com/michiharu/deploy-astro-to-github-pages)ã§ã™ã€‚

ã¡ãªã¿ã« Bun ã¨ Astro ã¯åˆä½“é¨“ã§ã™ã€‚

## ç’°å¢ƒæ§‹ç¯‰

VSCodeã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã¨ã—ã¦é€²ã‚ã¾ã™ã€‚

### Bun ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ç§ã¯macOSãªã®ã§[å…¬å¼ãƒšãƒ¼ã‚¸ã®æ–¹æ³•](https://bun.sh/)ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸã€‚

```zsh
curl -fsSL https://bun.sh/install | bash
bun -v
1.0.2
```

### Bun + Astro ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

Bunå´ã¨Astroå´ã«ãã‚Œãã‚Œè¨˜äº‹ãŒã‚ã‚Šã¾ã™ã€‚

- [Bun: Build an app with Astro and Bun](https://bun.sh/guides/ecosystem/astro)
- [Astro: Use Bun with Astro](https://docs.astro.build/ja/recipes/bun/)

ç§ã¯Bunå´ã®è¨˜äº‹ã‚’å‚è€ƒã«ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã—ãŸã€‚

```bash
bun create astro
```

<Image name="bun-create-astro.png" />

ã„ãã¤ã‹è³ªå•ã•ã‚Œã¾ã™ãŒã€ä»Šå›ã®è¨˜äº‹ã§é‡è¦ãªã®ã¯ä»¥ä¸‹ã®ï¼’ã¤ã§ã™ã€‚

- tmpl: How would you like to start your new project?
  - Use blog template ï¼ˆãƒ–ãƒ­ã‚°ãƒ»ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ã†ï¼‰
- ts: Do you plan to write TypeScript?
  - Yes ï¼ˆTypeScriptã‚’ä½¿ã†ï¼‰

## Github Pagesã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š

ã“ã“ã‹ã‚‰ã¯VSCodeã‚’é–‹ã„ã¦ä½œæ¥­ã—ã¾ã—ãŸã€‚

ã¾ãšã¯ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼([http://localhost:4321](http://localhost:4321))ã§ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã¾ã™ã€‚

```bash
bun run dev
```

<Image name="bun-run-dev.png" />

Github Pagesã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã«ã¯ã€æ¬¡ã®ï¼’ç‚¹ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚

- GitHub Pagesã®ãƒªãƒ³ã‚¯ã¯ã€ãƒªãƒã‚¸ãƒˆãƒªåã‚’ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã™ã‚‹URL
- GitHub Pagesã®ãƒšãƒ¼ã‚¸ãƒªãƒ³ã‚¯ã¯ã€æœ«å°¾ã®`/`(trailing slash)ãŒå¿…é ˆ
  - æœ«å°¾ã®`/`ãŒç„¡ã„å ´åˆã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹

### `astro.config.mjs`ã®ç·¨é›†

[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã“ã¡ã‚‰](https://docs.astro.build/ja/guides/deploy/github/)ã§ã™ã€‚

```js
import { defineConfig } from 'astro/config';
import mdx from '@astrojs/mdx';

import sitemap from '@astrojs/sitemap';

// https://astro.build/config
export default defineConfig({
  site: 'https://michiharu.github.io',
  base: '/deploy-astro-to-github-pages',
  trailingSlash: 'always',
  integrations: [mdx(), sitemap()],
});
```

`michiharu`ã¯ç§ã®GitHubãƒ¦ãƒ¼ã‚¶ãƒ¼IDã€`deploy-astro-to-github-pages`ã¯ãƒªãƒã‚¸ãƒˆãƒªåã§ã™ã€‚
é©å®œã”è‡ªèº«ã®ç’°å¢ƒã«åˆã‚ã›ã¦èª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯è¨˜è¿°ã•ã‚Œã¦ã„ã¾ã›ã‚“ãŒ trailing slash ã«ã¤ã„ã¦ã®è¨­å®šã‚’è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚
ãã®ã¾ã¾ã§ã‚‚å‹•ãã¾ã™ãŒé–‹ç™ºç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã§ç•°ãªã‚‹æŒ¯ã‚‹èˆã„ã¯ãƒã‚°ã®åŸå› ã«ãªã‚‹ã®ã§ã€
æœ¬ç•ªç’°å¢ƒã«åˆã‚ã›ã¦`trailingSlash: 'always'`ã‚’è¨­å®šã—ã¾ã—ã‚‡ã†ã€‚
è¨­å®šã—ã¦ãŠã‘ã°ã€Œãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯è¡¨ç¤ºã•ã‚Œã¦ã„ãŸã®ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã‚‰404ã€ã¨ã„ã†äº‹æ•…ã‚’é˜²ã’ã¾ã™ã€‚

### å„ãƒªãƒ³ã‚¯ã®ä¿®æ­£

ä¸Šè¨˜ã®`astro.config.mjs`ã‚’ç·¨é›†ã™ã‚‹ã¨[http://localhost:4321](http://localhost:4321)ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«404ã«ãªã‚Šã¾ã™ã€‚

<Image name="404-not-found.png" />

ã“ã®404ãƒšãƒ¼ã‚¸ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹`/deploy-astro-to-github-pages/`ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨å†ã³Homeãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

<Image name="subdirectory-home.png" />

ã—ã‹ã—ãƒ˜ãƒƒãƒ€ãƒ¼ã®Blogã€Aboutãªã©ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨404ã¨ãªã‚Šã¾ã™ã€‚ã“ã‚Œã¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å„ãƒªãƒ³ã‚¯ã¯ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å«ã‚“ã§ã„ãªã„ãŸã‚ã§ã™ã€‚

ãã®ãŸã‚ã™ã¹ã¦ã®ãƒªãƒ³ã‚¯ã«ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å«ã‚ã‚‹ä¿®æ­£ãŒå¿…è¦ã§ã™ã€‚ã“ã®èª²é¡Œã¸ã®å¯¾å‡¦ã«ã¯ã¿ãªã•ã‚“ã„ã‚ã„ã‚è©¦è¡ŒéŒ¯èª¤ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ãŒã€ä»Šã®ã¨ã“ã‚ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¨è¨€ãˆã‚‹æ–¹æ³•ã¯ãªã„ã‚ˆã†ã§ã™ã€‚

ç§ã¯åœ°é“ã«ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’URLã«å«ã‚€ã‚ˆã†ä¿®æ­£ã—ã¾ã—ãŸã€‚`astro.config.mjs`ã®`base`ã¯ã€ãƒªãƒã‚¸ãƒˆãƒªåã§ã‚ã‚Šã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã™ã€‚ã“ã®`base`ã®å€¤ã¯`import.meta.env.BASE_URL`ã‹ã‚‰å‚ç…§ã§ãã‚‹ã®ã§ã€ç§ã¯æ¬¡ã®ã‚ˆã†ãª`url`é–¢æ•°ã§`import.meta.env.BASE_URL`ã®å‚ç…§ã‚’å…±é€šåŒ–ã—ã¾ã—ãŸã€‚`url`é–¢æ•°ã‚’ä½¿ã†ã“ã¨ã§ã€JSå´ã¯ã¾ã¨ã‚ã¦ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’URLã«å«ã‚ã‚‰ã‚Œã¾ã™ã€‚

````typescript
/**
 * ```typescript
 * new URL('/')          => '/subdirectory/'
 * new URL('/blog/')     => '/subdirectory/blog/'
 * new URL('/image.png') => '/subdirectory/image.png'
 * ```
 */
export const url = (path: string | undefined) => {
  if (path === undefined) return undefined;
  const base = import.meta.env.BASE_URL.replace(/\/$/, '');
  return `${base}${path}`;
};
````

URLã®ä¿®æ­£ç‚¹ã¯[ã“ã¡ã‚‰ã®ã‚³ãƒŸãƒƒãƒˆ](https://github.com/michiharu/deploy-astro-to-github-pages/commit/fedc5e4acd312c98080b0b7f0f0b9af2d5c0543b)ã‚’ã”ç¢ºèªãã ã•ã„ã€‚

ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’é–‹ã„ã¦ä»¥ä¸‹ã®ï¼”ç¨®é¡ã®ãƒšãƒ¼ã‚¸ã®é·ç§»ã‚’è©¦ã—ãªãŒã‚‰ä¸å…·åˆãƒ»ã‚¨ãƒ©ãƒ¼ãŒãªã„ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã¾ã™ã€‚

- `/subdirectory/`
- `/subdirectory/blog/`
- `/subdirectory/blog/markdown-style-guide/`ãªã©
- `/subdirectory/about/`

`src/components/Header.astro`ã®ä¿®æ­£ä¾‹

```diff
-   <h2><a href="/">{SITE_TITLE}</a></h2>
+   <h2><a href={url('/')}>{SITE_TITLE}</a></h2>
    <div class="internal-links">
-     <HeaderLink href="/">Home</HeaderLink>
-     <HeaderLink href="/blog">Blog</HeaderLink>
-     <HeaderLink href="/about">About</HeaderLink>
+     <HeaderLink href={url('/')}>Home</HeaderLink>
+     <HeaderLink href={url('/blog/')}>Blog</HeaderLink>
+     <HeaderLink href={url('/about/')}>About</HeaderLink>
    </div>
```

`BlogPost.astro`ã®ä¿®æ­£ä¾‹

```diff
...
import { url } from '../funcs';
...
- const { title, description, pubDate, updatedDate, heroImage } = Astro.props;
+ const { title, description, pubDate, updatedDate } = Astro.props;
+ const heroImage = new URL(Astro.props.heroImage);
...
```

ç¶šã„ã¦ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ãªã„ã¨å¿˜ã‚ŒãŒã¡ãªã®ãŒCSSã«è¨˜è¿°ã•ã‚ŒãŸãƒ•ã‚©ãƒ³ãƒˆã®ãƒªãƒ³ã‚¯ã§ã™ã€‚ä»¥ä¸‹ã¯`global.css`ã®ä¿®æ­£ä¾‹ã§ã™ã€‚

```diff
...
@font-face {
  font-family: 'Atkinson';
- src: new URL('/fonts/atkinson-regular.woff') format('woff');
+ src: new URL('/my-way/fonts/atkinson-regular.woff') format('woff');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'Atkinson';
- src: new URL('/fonts/atkinson-bold.woff') format('woff');
+ src: new URL('/my-way/fonts/atkinson-bold.woff') format('woff');
  font-weight: 700;
  font-style: normal;
  font-display: swap;
}
...
```

`url`é–¢æ•°ã¯CSSã«ã¯ä½¿ãˆãªã„ãŸã‚ã€ç›´æ¥ãƒ‡ãƒ—ãƒ­ã‚¤äºˆå®šã®ãƒªãƒã‚¸ãƒˆãƒªåã‚’å«ã‚ã¦ã„ã¾ã™ã€‚

### GitHub Actions ã®è¨­å®š

ã¾ãšGitHubã®ãƒšãƒ¼ã‚¸ã§ã€Settings > Pages > Build and deployment > Source ã§ `GitHub Actions` ã‚’é¸æŠã—ã¾ã™ã€‚

<Image name="github-pages-setting.png" />

æ¬¡ã«[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.astro.build/ja/guides/deploy/github/)ã‹ã‚‰ã‚³ãƒ”ãƒšã—ã¦`.github/workflows/deploy.yml`ã‚’é…ç½®ã—ã¾ã™ã€‚

```yml
name: Deploy to GitHub Pages

on:
  # Trigger the workflow every time you push to the `main` branch
  # Using a different branch name? Replace `main` with your branchâ€™s name
  push:
    branches: [main]
  # Allows you to run this workflow manually from the Actions tab on GitHub.
  workflow_dispatch:

# Allow this job to clone the repo and create a page deployment
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout your repository using git
        uses: actions/checkout@v3
      - name: Install, build, and upload your site
        uses: withastro/action@v0
        # with:
        # path: . # The root location of your Astro project inside the repository. (optional)
        # node-version: 20 # The specific version of Node that should be used to build your site. Defaults to 16. (optional)
        # package-manager: yarn # The Node package manager that should be used to install dependencies and build your site. Automatically detected based on your lockfile. (optional)

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v1
```

ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã•ã‚Œã¦ã„ã‚‹`with:`ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ä½¿ç”¨ã—ãªãã¦ã‚‚ã€
`bun install`ãŒå®Ÿè¡Œã•ã‚Œ GitHub Pagesã¸ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¾ã™ã€‚

<Image name="deploy-success.png" />

ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ğŸ‰ ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚
